<!DOCTYPE html>

<html>
<head>
    <script type="text/javascript" src="test.js"></script>
    <script type="text/javascript" src="../script/jquery-1.8.1.min.js"></script>
    <script type="text/javascript" src="../script/calendar.js"></script>

    <script type="text/javascript">
        var sampleCalendarData = {"version":"1.0", "encoding":"UTF-8", "feed":{"xmlns":"http://www.w3.org/2005/Atom", "xmlns$openSearch":"http://a9.com/-/spec/opensearchrss/1.0/", "xmlns$gCal":"http://schemas.google.com/gCal/2005", "xmlns$gd":"http://schemas.google.com/g/2005", "id":{"$t":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full"}, "updated":{"$t":"2012-09-20T09:51:00.000Z"}, "category":[
            {"scheme":"http://schemas.google.com/g/2005#kind", "term":"http://schemas.google.com/g/2005#event"}
        ], "title":{"$t":"Usergroup.se (curated by @xlson @peter_lind @msundb)", "type":"text"}, "subtitle":{"$t":"A collection off the different developer events that are available in the Stockholm area. The events in the calendar should be geared towards developers and not be focused on product marketing/sales.\n\nKinds of events that fit:\n- Conferences\n- User group meetings\n- Workshops\n\nKnow of any events that should be in the calendar? Contact us on twitter: @xlson @peter_lind @mikaelsundberg!", "type":"text"}, "link":[
            {"rel":"alternate", "type":"text/html", "href":"http://www.google.com/calendar/embed?src=oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com"},
            {"rel":"http://schemas.google.com/g/2005#feed", "type":"application/atom+xml", "href":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full"},
            {"rel":"http://schemas.google.com/g/2005#batch", "type":"application/atom+xml", "href":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full/batch"},
            {"rel":"self", "type":"application/atom+xml", "href":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full?alt=json&max-results=3&singleevents=true&futureevents=true&sortorder=ascending&orderby=starttime"},
            {"rel":"next", "type":"application/atom+xml", "href":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full?alt=json&start-index=4&max-results=3&singleevents=true&futureevents=true&sortorder=ascending&orderby=starttime"}
        ], "author":[
            {"name":{"$t":"mikael.sundberg82@gmail.com"}, "email":{"$t":"mikael.sundberg82@gmail.com"}}
        ], "generator":{"$t":"Google Calendar", "version":"1.0", "uri":"http://www.google.com/calendar"}, "openSearch$totalResults":{"$t":2780}, "openSearch$startIndex":{"$t":1}, "openSearch$itemsPerPage":{"$t":3}, "gCal$timezone":{"value":"Europe/Stockholm"}, "gCal$timesCleaned":{"value":0}, "gd$where":{"valueString":"Stockholm"}, "entry":[
            {"id":{"$t":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full/avvj5648l25hrah7ji8vcbt0dk"}, "published":{"$t":"2012-09-17T10:48:12.000Z"}, "updated":{"$t":"2012-09-17T10:48:12.000Z"}, "category":[
                {"scheme":"http://schemas.google.com/g/2005#kind", "term":"http://schemas.google.com/g/2005#event"}
            ], "title":{"$t":"MongoDb meetup: What's new in 2.2", "type":"text"}, "content":{"$t":"See http://www.meetup.com/Stockholm-MongoDB-User-Group/events/78381172/", "type":"text"}, "link":[
                {"rel":"alternate", "type":"text/html", "href":"http://www.google.com/calendar/event?eid=YXZ2ajU2NDhsMjVocmFoN2ppOHZjYnQwZGsgb2FybjI5aXIydm0ya2pmYWE1dm9mN3FpY2dAZw", "title":"alternate"},
                {"rel":"self", "type":"application/atom+xml", "href":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full/avvj5648l25hrah7ji8vcbt0dk"}
            ], "author":[
                {"name":{"$t":"Usergroup.se (curated by @xlson @peter_lind @msundb)"}}
            ], "gd$comments":{"gd$feedLink":{"href":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full/avvj5648l25hrah7ji8vcbt0dk/comments"}}, "gd$eventStatus":{"value":"http://schemas.google.com/g/2005#event.confirmed"}, "gd$where":[
                {"valueString":"Valtech"}
            ], "gd$who":[
                {"email":"oarn29ir2vm2kjfaa5vof7qicg@group.calendar.google.com", "rel":"http://schemas.google.com/g/2005#event.organizer", "valueString":"Usergroup.se (curated by @xlson @peter_lind @msundb)"}
            ], "gd$when":[
                {"endTime":"2012-09-20T22:00:00.000+02:00", "startTime":"2012-09-20T17:00:00.000+02:00"}
            ], "gd$transparency":{"value":"http://schemas.google.com/g/2005#event.opaque"}, "gCal$anyoneCanAddSelf":{"value":"false"}, "gCal$guestsCanInviteOthers":{"value":"true"}, "gCal$guestsCanModify":{"value":"false"}, "gCal$guestsCanSeeGuests":{"value":"true"}, "gCal$sequence":{"value":0}, "gCal$uid":{"value":"avvj5648l25hrah7ji8vcbt0dk@google.com"}},
            {"id":{"$t":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full/fke22ei9mmeu1f56e8tn0ne0n4"}, "published":{"$t":"2012-09-10T12:16:02.000Z"}, "updated":{"$t":"2012-09-10T12:16:03.000Z"}, "category":[
                {"scheme":"http://schemas.google.com/g/2005#kind", "term":"http://schemas.google.com/g/2005#event"}
            ], "title":{"$t":" FuncProgSTHLM and Campanja presents Switching to Erlang for Fun and Profit!", "type":"text"}, "content":{"$t":"Berner, the CTO of Campanja, will talk about Campanja's experiences moving to Erlang, how they  ended up doing it, lessons learned and challenges they faced.\n\nhttp://funcprogsthlm-campanja-estw.eventbrite.com/", "type":"text"}, "link":[
                {"rel":"alternate", "type":"text/html", "href":"http://www.google.com/calendar/event?eid=ZmtlMjJlaTltbWV1MWY1NmU4dG4wbmUwbjQgb2FybjI5aXIydm0ya2pmYWE1dm9mN3FpY2dAZw", "title":"alternate"},
                {"rel":"self", "type":"application/atom+xml", "href":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full/fke22ei9mmeu1f56e8tn0ne0n4"}
            ], "author":[
                {"name":{"$t":"Usergroup.se (curated by @xlson @peter_lind @msundb)"}}
            ], "gd$comments":{"gd$feedLink":{"href":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full/fke22ei9mmeu1f56e8tn0ne0n4/comments"}}, "gd$eventStatus":{"value":"http://schemas.google.com/g/2005#event.confirmed"}, "gd$where":[
                {"valueString":"Campanja, Kungsgatan 27"}
            ], "gd$who":[
                {"email":"oarn29ir2vm2kjfaa5vof7qicg@group.calendar.google.com", "rel":"http://schemas.google.com/g/2005#event.organizer", "valueString":"Usergroup.se (curated by @xlson @peter_lind @msundb)"}
            ], "gd$when":[
                {"endTime":"2012-09-20T21:00:00.000+02:00", "startTime":"2012-09-20T18:00:00.000+02:00"}
            ], "gd$transparency":{"value":"http://schemas.google.com/g/2005#event.opaque"}, "gCal$anyoneCanAddSelf":{"value":"false"}, "gCal$guestsCanInviteOthers":{"value":"true"}, "gCal$guestsCanModify":{"value":"false"}, "gCal$guestsCanSeeGuests":{"value":"true"}, "gCal$sequence":{"value":0}, "gCal$uid":{"value":"fke22ei9mmeu1f56e8tn0ne0n4@google.com"}},
            {"id":{"$t":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full/21lrstoi00ho13ikr9qgqh04tc"}, "published":{"$t":"2012-09-10T20:57:48.000Z"}, "updated":{"$t":"2012-09-10T20:57:48.000Z"}, "category":[
                {"scheme":"http://schemas.google.com/g/2005#kind", "term":"http://schemas.google.com/g/2005#event"}
            ], "title":{"$t":"Lunch Beat Sthlm", "type":"text"}, "content":{"$t":"https://www.facebook.com/events/464744356889749/permalink/464773136886871/", "type":"text"}, "link":[
                {"rel":"alternate", "type":"text/html", "href":"http://www.google.com/calendar/event?eid=MjFscnN0b2kwMGhvMTNpa3I5cWdxaDA0dGMgb2FybjI5aXIydm0ya2pmYWE1dm9mN3FpY2dAZw", "title":"alternate"},
                {"rel":"self", "type":"application/atom+xml", "href":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full/21lrstoi00ho13ikr9qgqh04tc"}
            ], "author":[
                {"name":{"$t":"Usergroup.se (curated by @xlson @peter_lind @msundb)"}}
            ], "gd$comments":{"gd$feedLink":{"href":"http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg%40group.calendar.google.com/public/full/21lrstoi00ho13ikr9qgqh04tc/comments"}}, "gd$eventStatus":{"value":"http://schemas.google.com/g/2005#event.confirmed"}, "gd$where":[
                {"valueString":"Kulturhuset"}
            ], "gd$who":[
                {"email":"oarn29ir2vm2kjfaa5vof7qicg@group.calendar.google.com", "rel":"http://schemas.google.com/g/2005#event.organizer", "valueString":"Usergroup.se (curated by @xlson @peter_lind @msundb)"}
            ], "gd$when":[
                {"endTime":"2012-09-21T13:00:00.000+02:00", "startTime":"2012-09-21T12:00:00.000+02:00"}
            ], "gd$transparency":{"value":"http://schemas.google.com/g/2005#event.transparent"}, "gCal$anyoneCanAddSelf":{"value":"false"}, "gCal$guestsCanInviteOthers":{"value":"true"}, "gCal$guestsCanModify":{"value":"false"}, "gCal$guestsCanSeeGuests":{"value":"true"}, "gCal$sequence":{"value":0}, "gCal$uid":{"value":"21lrstoi00ho13ikr9qgqh04tc@google.com"}}
        ]}};

        var CalendarTest = {
            setUp:function () {
                this._calendar = new Calendar();
            },

            testFeedURLComposition:function () {
                var noCalendarIdAccepted = false;

                try {
                    Calendar._calendarFeedURL({});
                    noCalendarIdAccepted = true;
                } catch (e) {
                }

                assertEquals(false, noCalendarIdAccepted, "Missing calendar id should not be accepted");

                var options = {calendarId:"mycalendarid"};

                assertTrue(Calendar._calendarFeedURL(options).indexOf("mycalendarid") != -1);
                assertTrue(Calendar._calendarFeedURL(options).indexOf("alt=json") != -1);

                assertTrue(Calendar._calendarFeedURL(options).indexOf("orderby") === -1, "OrderBy not specified");
                options.orderBy = "starttime";
                assertTrue(Calendar._calendarFeedURL(options).indexOf("orderby=starttime") != -1, "OrderBy specified");

                assertTrue(Calendar._calendarFeedURL(options).indexOf("max-results") == -1);
                options.maxResults = 123;
                assertTrue(Calendar._calendarFeedURL(options).indexOf("max-results=123") != -1);
            },

            testLoadFeed: function() {
                this._loadSampleCalendarData();

                assertEquals(3, this._calendar._entries.length);

                assertEquals("MongoDb meetup: What's new in 2.2", this._calendar._entries[0].title);
                assertEquals("See http://www.meetup.com/Stockholm-MongoDB-User-Group/events/78381172/", this._calendar._entries[0].content);
                assertEquals(sampleCalendarData, this._calendar._entries[0]._definition);

                assertEquals(" FuncProgSTHLM and Campanja presents Switching to Erlang for Fun and Profit!", this._calendar._entries[1].title);
                assertTrue(this._calendar._entries[1].content.indexOf("Berner, the CTO of Campanja,") != -1);
                assertEquals(sampleCalendarData, this._calendar._entries[1]._definition);

                assertEquals("Lunch Beat Sthlm", this._calendar._entries[2].title);
                assertEquals("https://www.facebook.com/events/464744356889749/permalink/464773136886871/", this._calendar._entries[2].content);
                assertEquals(sampleCalendarData, this._calendar._entries[2]._definition);
            },

            testLoadFeedShouldRaiseSingleEvent: function() {
                var addedEvents = null;

                this._calendar.setOptions({
                    onEventsAdded: function(events) {
                        addedEvents = events;
                    }
                });

                this._loadSampleCalendarData();

                assertNotNull(addedEvents);
                assertEquals(3, addedEvents.length);
            },

            _loadSampleCalendarData: function() {
                this._calendar._loadURL = function(url, callback) {
                    assertTrue(url.indexOf("aptitud-test") != -1);
                    callback(sampleCalendarData);
                };

                this._calendar.loadFeed({calendarId: "aptitud-test"});
            }
        };
    </script>

    <!--
    <script type="text/javascript">
        function googleInit() {
            gapi.client.setApiKey("AIzaSyCkhYBaOeS4KpXuARjmFLUoX2X2GzCDB14");
        }

    </script>

    <script src="https://apis.google.com/js/client.js?onload=googleInit"></script>
    -->

    <!--
    <script type="text/javascript">
        function calendarLoaded(obj) {
            alert("Loaded...");
        }
    </script>

    <script src="http://www.google.com/calendar/feeds/oarn29ir2vm2kjfaa5vof7qicg@group.calendar.google.com/public/full?alt=json-in-script&callback=calendarLoaded&orderby=starttime&max-results=15&singleevents=true&sortorder=ascending&futureevents=true"></script>-->

    <style type="text/css">
        .aptitud-calendar-event {
            background: #DDDDDD;
            max-width: 20%;
            margin: 10px;
            overflow: auto;
        }
    </style>

    <script type="text/javascript">

        function onTestsCompleted() {
            $(function() {
                var testCalendar = new Calendar({});

                testCalendar.displayWithRandomizedLayout(document.getElementById("sampleCalendar"));
                testCalendar._loadURL = function(url, callback) { callback(sampleCalendarData); };
                testCalendar.loadFeed({calendarId: "mycalendar"});
            });
        }
    </script>
</head>
<body>


<div id="sampleCalendar">
</div>

</body>
</html>