<html>
<head>
    <script type="text/javascript" src="test.js"></script>
    <script type="text/javascript" src="../script/jquery-1.8.1.min.js"></script>
    <script type="text/javascript" src="../script/navigation.js"></script>
</head>
<body>
<script type="text/javascript">
    var NavigationTest = {
        setUp: function() {
            this._setLocation("");
            this._navigator = new Navigator();
        },

        tearDown: function() {
            this._navigator.dispose();
        },

        testGetLocation: function() {
            this._setLocation("");
            assertEquals("", this._navigator.getLocation());

            this._setLocation("foobar");
            assertEquals("foobar", this._navigator.getLocation());
        },

        testSubscriberShouldEventuallyBeNotifiedOnManualHashChange: function(ctx) {
            this._navigator.subscribe("manuallyChangedHash", function() {
                ctx.async.done();
            });

            this._setLocation("manuallyChangedHash");

            ctx.async.spinOff(1000);
        },

        testSubscriberShouldBeImmediatelyNotifiedOnNavigatorChange: function() {
            var notified = false;

            this._navigator.subscribe("otherHash", function() {
                notified = true;
            });

            this._navigator.navigate("otherHash");

            assertTrue(notified);
        },

        _setLocation: function(location) {
            var currentUrl = window.location.href;
            var n = currentUrl.lastIndexOf("#");

            if (n != -1) {
                currentUrl = currentUrl.substring(0, n);
            }

            window.location.href = currentUrl + "#" + location;
        }
    };
</script>
</body>
</html>